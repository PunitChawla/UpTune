"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[920],{4863:function(e,t,r){r.d(t,{Appbar:function(){return n}});var a=r(7437),s=r(998),l=r(495),o=r(4504),i=r(7138);function n(){var e,t;let r=(0,s.useSession)();return(0,a.jsx)("div",{className:"h-8",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)(i.default,{className:"flex items-center justify-center",href:"#",children:[(0,a.jsx)(o.Z,{className:"h-6 w-6 text-purple-500"}),(0,a.jsx)("span",{className:"ml-2 text-2xl font-bold text-white",children:"Melodi"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("nav",{className:"ml-auto flex gap-4 sm:gap-6 pt-3 pr-3",children:[!(null===(e=r.data)||void 0===e?void 0:e.user)&&(0,a.jsx)(l.z,{className:"bg-purple-600 text-white hover:bg-purple-700",onClick:()=>(0,s.signIn)(),children:"signIn"}),(null===(t=r.data)||void 0===t?void 0:t.user)&&(0,a.jsx)(l.z,{className:"bg-purple-600 text-white hover:bg-purple-700",onClick:()=>(0,s.signOut)({callbackUrl:"/"}),children:"Logout"})]})})]})})}},6920:function(e,t,r){r.d(t,{default:function(){return b}});var a=r(7437),s=r(2265),l=r(7440);let o=s.forwardRef((e,t)=>{let{className:r,type:s,...o}=e;return(0,a.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input";var i=r(495);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...s})}).displayName="CardHeader",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";var d=r(1510),u=r(8094),m=r(5636),g=r(3722),x=r(5956);r(4193);var f=r(4863),p=r(6552),h=r.n(p);let v=e=>{let t=e.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(.+)/);return t?t[1]:null};function b(e){let{creatorId:t,playVideo:r}=e,[l,p]=(0,s.useState)(""),[b,y]=(0,s.useState)(null),[j,N]=(0,s.useState)([]),[w,k]=(0,s.useState)(null),[C,S]=(0,s.useState)(!1),[I,z]=(0,s.useState)(!1),R=(0,s.useRef)(),U=!1;async function O(){if(!0==U)return;U=!0;let e=await fetch("/api/streams/?creatorId=".concat(t),{credentials:"include"});if(console.log(t),e.ok){let t=await e.json();t.streams.forEach(e=>{let t=v(e.url)||"",r=e.title,a=e.upvote,s=e.id,l=e.haveUpvote,o=e.bigImg,i=e.extractedId,n=e.url;N(e=>[...e,{streamId:s,id:t,title:r,votes:a,haveUpvote:l,bigImg:o,extractedId:i,url:n}])}),k(t.activeStream)}}(0,s.useEffect)(()=>{O(),setInterval(()=>{})},[1e4]),(0,s.useEffect)(()=>{if(!R){console.log("not done");return}let e=h()(R.current);e.loadVideoById(null==w?void 0:w.extractedId),e.playVideo(),e.on("stateChange",e=>{console.log(e.data)})},[w,R]);let E=async()=>{p(""),y(null);let e=v(l);if(e){z(!0);let r=await fetch("/api/streams",{method:"POST",body:JSON.stringify({creatorId:t,url:l})});r.ok&&N([...j,{id:e,title:(await r.json()).title,votes:0,haveUpvote:!1}]),z(!1)}},P=(e,t,r)=>{let a=[...j];a[t].votes+=r,a[t].haveUpvote=1===r,a.sort((e,t)=>t.votes-e.votes),N(a),fetch(1===r?"/api/streams/upvote":"/api/streams/downvote",{method:"POST",body:JSON.stringify({streamId:e})})},V=async()=>{if(j.length>0){S(!0);let e=await fetch("/api/streams/next",{method:"GET"});e.ok&&await e.json(),k(j[0]),N(j.slice(1))}S(!1)};return(0,a.jsxs)("div",{className:"w-full min-h-screen py-12 md:py-24 lg:py-5 xl:py-5 bg-gradient-to-br from-gray-900 via-gray-800 to-black text-gray-100",children:[(0,a.jsx)(f.Appbar,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4 space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-center text-gray-100",children:"Stream Song Voter"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[(0,a.jsx)(o,{type:"text",placeholder:"Enter YouTube URL",value:l,onChange:e=>{p(e.target.value),y(v(e.target.value))},className:"bg-gray-800 border-gray-700 text-gray-100 placeholder-gray-400"}),(0,a.jsx)(i.z,{onClick:E,disabled:I,className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:I?"Loading...":"Add to queue"})]}),b&&(0,a.jsx)("div",{className:"aspect-video",children:(0,a.jsx)("img",{src:"https://img.youtube.com/vi/".concat(b,"/0.jpg"),alt:"Video preview",className:"w-full h-full object-cover rounded-lg"})})]}),(0,a.jsx)("div",{className:" col-start-2 col-end-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-100",children:"Currently Playing"}),(0,a.jsxs)(i.z,{onClick:()=>{if(w){let e="".concat(window.location.hostname,":").concat(window.location.port,"/creator/").concat(t);navigator.clipboard.writeText(e).then(()=>{x.Am.success("Video URL copied to clipboard!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"})},e=>{console.error("Could not copy text: ",e),x.Am.error("Failed to copy URL. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark"})})}},className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"Share"]})]}),w&&(0,a.jsx)("div",{className:"aspect-video",children:(0,a.jsx)("iframe",{width:"100%",height:"100%",src:"https://www.youtube.com/embed/".concat(w.extractedId,"?autoplay=1"),frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"rounded-lg"})})]})}),r&&(0,a.jsxs)(i.z,{disabled:C,onClick:V,className:"w-full bg-purple-700 hover:bg-purple-800 text-white",children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),C?"Loading...":"Play next "]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-100",children:"Upcoming Songs"}),0==j.length&&(0,a.jsx)(n,{className:"bg-gray-900 border-gray-800",children:(0,a.jsxs)(c,{className:'"p-4',children:[(0,a.jsx)("p",{className:"text-center py-8 text-gray-400",children:" No video in queue"})," "]})}),j.map((e,t)=>(0,a.jsx)(n,{className:"bg-gray-800 border-gray-700",children:(0,a.jsxs)(c,{className:"flex items-center space-x-4 p-4",children:[(0,a.jsx)("img",{src:"https://img.youtube.com/vi/".concat(e.id,"/default.jpg"),alt:e.title,className:"w-24 h-18 object-cover rounded"}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-100",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Votes: ",e.votes]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(i.z,{size:"sm",variant:"outline",onClick:()=>!e.haveUpvote&&P(e.streamId,t,1),className:"border-gray-600 text-gray-300 hover:bg-gray-700",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})}),(0,a.jsx)(i.z,{size:"sm",variant:"outline",onClick:()=>e.haveUpvote&&P(e.streamId,t,-1),className:"border-gray-600 text-gray-300 hover:bg-gray-700",children:(0,a.jsx)(g.Z,{className:"w-4 h-4"})})]})]})},e.id))]})]}),(0,a.jsx)(x.Ix,{})]})}},495:function(e,t,r){r.d(t,{z:function(){return c}});var a=r(7437),s=r(2265),l=r(2974),o=r(2218),i=r(7440);let n=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:o,asChild:c=!1,...d}=e,u=c?l.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(n({variant:s,size:o,className:r})),ref:t,...d})});c.displayName="Button"},7440:function(e,t,r){r.d(t,{cn:function(){return l}});var a=r(4839),s=r(6164);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}}}]);