"use strict";(()=>{var e={};e.id=645,e.ids=[645],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},56028:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>q,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{GET:()=>d});var a=r(49303),i=r(88716),n=r(60670),o=r(86058),u=r(75571),p=r(87070);async function d(){let e=await (0,u.getServerSession)(),t=await o.m.user.findFirst({where:{email:e?.user?.email??""}});if(!t)return p.NextResponse.json({msg:"unathenticated"},{status:403});let r=await o.m.stream.findFirst({where:{userId:t.id,played:!1},orderBy:{upvote:{_count:"desc"}}});await Promise.all([o.m.currentStream.upsert({where:{userId:t.id},update:{userId:t.id,streamId:r?.id},create:{userId:t.id,streamId:r?.id}}),o.m.stream.update({where:{id:r?.id??""},data:{played:!0,playedTs:new Date}})]);let[s,a]=await Promise.all([await o.m.stream.findMany({where:{userId:t.id},include:{_count:{select:{upvote:!0}},upvote:{where:{userId:t.id}}}}),o.m.currentStream.findFirst({where:{userId:t.id},include:{stream:!0}})]);return p.NextResponse.json({streams:s.map(({_count:e,...t})=>({...t,upvote:e.upvote,haveUpvoted:!!t.upvote.length})),activeStream:a})}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/streams/next/route",pathname:"/api/streams/next",filename:"route",bundlePath:"app/api/streams/next/route"},resolvedPagePath:"D:\\ProjectBycohort\\MelodyMixer\\app\\app\\api\\streams\\next\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:x}=m,h="/api/streams/next/route";function q(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:c})}},86058:(e,t,r)=>{r.d(t,{m:()=>s});let s=new(require("@prisma/client")).PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,209,773],()=>r(56028));module.exports=s})();